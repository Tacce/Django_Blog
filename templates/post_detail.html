{% extends "base_generic.html" %}

{% block content %}
  <h1>{{ object.title }}</h1>
  <p>{{ object.content }}</p>
  <p>Created at: {{ object.created_at }}</p>
  <p>Last updated: {{ object.updated_at }}</p>

{% if user.is_authenticated and user == post.author %}
    <a href="{% url 'delete_post' post.pk %}" onclick="return confirm('Are you sure you want to delete this post?');">Delete Post</a>
{% endif %}

  <p>Likes: <span id="like-count-{{ post.id }}">{{ post.total_likes }}</span></p>
{% if user.is_authenticated %}
  <form action="{% url 'blogpost_like' object.id %}" method="POST">
    {% csrf_token %}

    {% if post_is_liked %}
    <button type="submit" name="blogpost_id" value="{{object.id}}" class="btn btn-info">Unlike</button>
    {% else %}
    <button type="submit" name="blogpost_id" value="{{object.id}}" class="btn btn-info">Like</button>
    {% endif %}
  </form>
{% else %}
  <a class="btn btn-outline-info" href="{% url 'login' %}?next={{request.path}}">Log in to like this article!</a><br>
{% endif %}

  <h2>Comments</h2>
  <ul>
    {% for comment in object.comments.all %}
      <li>
          <div class="user-wrapper">
            <img src="{{ comment.author.profile_image.url }}" alt="{{ comment.author.username }}" class="profile-image">
            <a href="{% url 'profile' comment.author%}">{{ comment.author }}</a>: {{ comment.content }}
            {% if user.is_authenticated %}
            {% if user == comment.author or user == post.author %}
                <a class="delete-comment" href="{% url 'delete_comment' post.pk comment.pk %}"
                   onclick="return confirm('Are you sure you want to delete this comment?');">Delete Comment</a>
            {% endif %}
            {% endif %}
          </div>
      </li>
    {% endfor %}
  </ul>
  <a href="{% url 'add_comment' object.pk %}">Add a comment</a>
{% endblock %}


